#!/usr/bin/env ruby

require 'circuit_patch_tools/patch'

ARGV.each do |src|
  raw = File.open(src, 'rb', encoding: Encoding::ASCII_8BIT).read
  patch = CircuitPatchTools::Patch.unpack(raw)
  patch.command = :replace_current_patch
  patch.location = 0
  filename = format('%s.sysx', patch.name)
  $stderr.puts "Writing to #{filename}"
  File.open(filename, 'wb', encoding: Encoding::ASCII_8BIT) do |f|
    f << patch.pack
  end
end
